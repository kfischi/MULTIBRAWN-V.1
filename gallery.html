}!DOCTYPE html>
const t=document.getElementById('navToggle');const m=document.getElementById('primaryNav');if(t&&m){t.addEventListener('click',()=>{const o=m.classList.toggle('active');t.setAttribute('aria-expanded',String(o));});}


// טעינת קבצים מה-GitHub API
const API='https://api.github.com/repos/kfischi/MULTIBRAWN-V.1/contents/Gallery';
const grid=document.getElementById('grid');
const search=document.getElementById('search');
const filters=document.querySelectorAll('.filter');
let items=[];let currentFilter='all';let query='';


const isImage=(name)=>/(\.avif|\.webp|\.jpg|\.jpeg|\.png)$/i.test(name);
const isVideo=(name)=>/(\.mp4|\.webm)$/i.test(name);


async function load(){
try{
const res=await fetch(API,{headers:{'Accept':'application/vnd.github+json'}});
if(!res.ok) throw new Error('GitHub API error');
const data=await res.json();
items=data.filter(x=>x.type==='file' && (isImage(x.name)||isVideo(x.name)))
.map(x=>({name:x.name,url:x.download_url,type:isImage(x.name)?'image':'video'}));
render();
}catch(e){grid.innerHTML=`<div class="card" style="padding:18px">שגיאה בטעינת גלריה. אפשר להעלות קבצים ל-<code>Gallery/</code> ב-GitHub או לטעון מחדש.</div>`;}
}


function render(){
const filtered=items.filter(i=> (currentFilter==='all'||i.type===currentFilter) && i.name.toLowerCase().includes(query.toLowerCase()));
grid.innerHTML = filtered.map(i=> card(i)).join('');
attachLightbox();
}


function card(i){
const badge=i.type==='image'?'תמונה':'סרטון';
const ctaMsg=encodeURIComponent(`שלום, אשמח פרטים על הקובץ: ${i.name}`);
const wa=`https://wa.me/972523983394?text=${ctaMsg}`;
const media=i.type==='image'
? `<img src="${i.url}" loading="lazy" alt="${i.name}" />`
: `<video src="${i.url}" controls preload="metadata"></video>`;
return `<article class="card" data-type="${i.type}" data-name="${i.name}">
<span class="badge">${badge}</span>
<a href="#" class="open" data-url="${i.url}" data-kind="${i.type}" aria-label="פתח ${badge}">${media}</a>
<div class="meta">
<span title="שם קובץ">${i.name}</span>
<a class="cta" href="${wa}" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i> בקשת פרטים</a>
</div>
</article>`;
}


filters.forEach(f=>f.addEventListener('click',()=>{filters.forEach(x=>x.classList.remove('active'));f.classList.add('active');currentFilter=f.dataset.filter;render();}));
search.addEventListener('input',e=>{query=e.target.value;render();});


// לייטבוקס
const lb=document.getElementById('lightbox');
const lbInner=document.getElementById('lbInner');
const close=document.getElementById('closeLb');
function attachLightbox(){
document.querySelectorAll('.open').forEach(a=>a.addEventListener('click',e=>{e.preventDefault();
const url=a.getAttribute('data-url');
const kind=a.getAttribute('data-kind');
lbInner.innerHTML = kind==='image' ? `<img src="${url}" alt="preview" />` : `<video src="${url}" controls autoplay></video>`;
lb.classList.add('open');
}));
close.addEventListener('click',()=> lb.classList.remove('open'));
lb.addEventListener('click',e=>{ if(e.target===lb) lb.classList.remove('open'); });


load();
</script>
</body>
</html>
