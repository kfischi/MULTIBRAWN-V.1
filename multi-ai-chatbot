<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××•×œ×˜×™ - ×™×•×¢×¥ ×—×›× ×¢× AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary-bg: #1A1230;
            --secondary-bg: #291a45;
            --accent-gold: #fbbf24;
            --accent-purple: #8e44ad;
            --light-purple: #9b59b6;
            --text-light: #ffffff;
            --text-muted: #b3b3b3;
            --success: #10b981;
            --error: #ef4444;
            --font-body: 'Heebo', sans-serif;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { height: 100%; }
        
        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .ai-header {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(142, 68, 173, 0.2));
            padding: 1rem;
            border-bottom: 1px solid rgba(251, 191, 36, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .ai-indicator {
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .ai-indicator.error {
            background: var(--error);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .control-btn {
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: var(--accent-gold);
            color: #000;
        }

        .chat-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .message { display: flex; gap: 0.75rem; max-width: 85%; animation: slideIn 0.3s ease-out; }
        
        @keyframes slideIn { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .message.user { align-self: flex-end; flex-direction: row-reverse; }
        .message-avatar { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
        .message.bot .message-avatar { background: linear-gradient(135deg, var(--accent-gold), var(--light-purple)); color: #000; }
        .message.user .message-avatar { background: linear-gradient(135deg, var(--light-purple), var(--accent-purple)); color: #fff; }
        
        .message-content { 
            background: var(--secondary-bg); 
            padding: 0.8rem 1.2rem; 
            border-radius: 18px; 
            border: 1px solid rgba(184, 134, 11, 0.2); 
            position: relative;
        }

        .message.user .message-content {
            background: rgba(142, 68, 173, 0.3);
            border-color: rgba(142, 68, 173, 0.5);
        }
        
        .message-text { line-height: 1.6; white-space: pre-wrap; }

        .ai-confidence {
            position: absolute;
            top: -8px;
            left: 10px;
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .quick-replies { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem; }
        .quick-reply { 
            background: rgba(184, 134, 11, 0.2); 
            color: var(--text-light); 
            padding: 0.5rem 1rem; 
            border-radius: 20px; 
            border: 1px solid rgba(184, 134, 11, 0.3); 
            cursor: pointer; 
            font-size: 0.9rem; 
            transition: all 0.2s ease; 
        }
        .quick-reply:hover { background: var(--accent-gold); color: #000; transform: translateY(-2px); }

        .ai-suggestion {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin: 0.5rem 0;
            font-style: italic;
        }

        .ai-suggestion::before {
            content: "ğŸ’¡ ×ª×•×‘× ×ª AI: ";
            font-weight: 700;
            color: var(--success);
        }
        
        .typing-indicator { display: none; align-items: center; gap: 0.5rem; color: var(--text-muted); padding: 0 1rem 0.5rem; }
        .typing-dots { display: flex; gap: 2px; }
        .typing-dot { width: 6px; height: 6px; background: var(--accent-gold); border-radius: 50%; animation: typing 1.4s ease-in-out infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-8px); } }
        
        .progress-container { background: rgba(0,0,0,0.2); height: 4px; position: relative; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent-gold), var(--light-purple)); width: 0%; transition: width 0.3s ease; }
        .progress-text { position: absolute; top: -25px; right: 10px; font-size: 0.8rem; color: var(--text-muted); }
        
        .summary-card { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(6, 182, 212, 0.2)); 
            border: 1px solid rgba(16, 185, 129, 0.3); 
            border-radius: 15px; 
            padding: 1.5rem; 
            margin: 0.5rem 0; 
        }
        .summary-title { font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .summary-content { line-height: 1.6; margin-bottom: 1.5rem; white-space: pre-wrap; font-size: 0.9rem; }
        
        .whatsapp-button { 
            background: #25d366; 
            color: white; 
            padding: 1rem; 
            border: none; 
            border-radius: 25px; 
            font-weight: 700; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.5rem; 
            width: 100%; 
            font-size: 1rem; 
            text-decoration: none; 
            transition: all 0.3s ease;
        }

        .whatsapp-button:hover {
            background: #128c7e;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.4);
        }
        
        .chat-input-area { padding: 1rem; border-top: 1px solid rgba(124, 58, 237, 0.2); background: rgba(26, 18, 48, 0.8); }
        .input-container { display: flex; gap: 0.5rem; align-items: center; }
        .chat-input { 
            flex: 1; 
            background: rgba(0,0,0,0.2); 
            border: 1px solid rgba(124, 58, 237, 0.3); 
            border-radius: 25px; 
            padding: 0.8rem 1rem; 
            color: white; 
            outline: none; 
            transition: all 0.3s ease;
        }
        .chat-input:focus { border-color: var(--accent-gold); box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2); }
        .send-button { width: 45px; height: 45px; background: var(--accent-purple); border: none; border-radius: 50%; color: white; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .send-button:hover { background: var(--light-purple); transform: scale(1.05); }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--error);
            padding: 1rem;
            border-radius: 10px;
            margin: 0.5rem 0;
        }

        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px; height: 40px;
            border: 4px solid rgba(251, 191, 36, 0.3);
            border-top: 4px solid var(--accent-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .ai-header { flex-direction: column; gap: 0.5rem; text-align: center; }
            .message { max-width: 95%; }
        }
    </style>
</head>
<body>
    <div class="ai-header">
        <div class="ai-status">
            <div class="ai-indicator" id="aiIndicator"></div>
            <span id="aiStatus">××•×œ×˜×™ AI ××ª×—×‘×¨...</span>
        </div>
        <button class="control-btn" onclick="resetConversation()">
            <i class="fas fa-redo"></i> ×”×ª×—×œ ××—×“×©
        </button>
    </div>

    <div class="chat-area">
        <div class="progress-container">
            <div class="progress-text" id="progressText">0/9 ×©××œ×•×ª</div>
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="typing-indicator" id="typingIndicator">
            <span>××•×œ×˜×™ AI ×—×•×©×‘ ×•×× ×ª×—...</span>
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
        <div class="chat-input-area">
            <div class="input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="×”×§×œ×“ ××ª ×ª×©×•×‘×ª×š ×›××Ÿ...">
                <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <script>
        let chatState = {};
        let aiMemory = [];
        
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const typingIndicator = document.getElementById('typingIndicator');
        const aiIndicator = document.getElementById('aiIndicator');
        const aiStatus = document.getElementById('aiStatus');

        const chatFlow = [
            { 
                key: "vacationType", 
                question: "×©×œ×•×! ×× ×™ ××•×œ×˜×™ ×¢× ×‘×™× ×” ××œ××›×•×ª×™×ª ××ª×§×“××ª! ğŸ¤–âœ¨\n\n×‘×•××• × ×ª×—×™×œ ×œ××¡×•×£ ×¤×¨×˜×™× ×•× ××¦× ×œ×›× ××ª ×”××§×•× ×”××•×©×œ×. ××” ×¡×•×’ ×”×—×•×¤×©×” ××• ×”××™×¨×•×¢?", 
                options: ["×—×•×¤×©×” ××©×¤×—×ª×™×ª", "×¡×•×¤\"×© ×¨×•×× ×˜×™", "××™×¨×•×¢/××¡×™×‘×”", "×—×ª×•× ×”", "××™×¨×•×¢ ×¢×¡×§×™", "× ×¡×™×¢×ª ×¢×‘×•×“×”"],
                aiPrompt: "×”××©×ª××© ×‘×—×¨ ×¡×•×’ ×—×•×¤×©×”. × ×ª×— ××ª ×”×‘×—×™×¨×” ×•×”××œ×¥ ×ª×•×‘× ×” ×§×¦×¨×” ×•×¨×œ×•×•× ×˜×™×ª ×¢×œ ×”×‘×—×™×¨×”."
            },
            { 
                key: "groupSize", 
                question: "××¢×•×œ×”! ×›××” ×× ×©×™× ××ª×? ×–×” ×™×¢×–×•×¨ ×œ×™ ×œ××¦×•× ××ª ×”×’×•×“×œ ×”××•×©×œ×.", 
                options: ["×–×•×’ (2)", "3-5", "6-10", "11-25", "25-50", "50-100", "100+ (××™×¨×•×¢ ×’×“×•×œ)"],
                aiPrompt: "×¢×œ ×‘×¡×™×¡ ×¡×•×’ ×”×—×•×¤×©×” ×•×’×•×“×œ ×”×§×‘×•×¦×”, ×ª×Ÿ ×ª×•×‘× ×” ×—×›××” ×¢×œ ×¡×•×’ ×”× ×›×¡ ×”××ª××™×."
            },
            { 
                key: "timeframe", 
                question: "××ª×™ ×‘×¢×¨×š ×ª×¨×¦×• ×œ×¦××ª ×œ×—×•×¤×©×”? ×–×” ×™×¢×–×•×¨ ×œ×™ ×œ×‘×“×•×§ ×–××™× ×•×ª ×•××—×™×¨×™×.",
                options: ["×”×¡×•×¤\"×© ×”×§×¨×•×‘ (×“×—×•×£!)", "×”×—×•×“×© ×”×§×¨×•×‘", "×‘×—×•×“×©×™×™× ×”×§×¨×•×‘×™×", "×œ×§×¨××ª ×”×—×’×™×", "×’××™×© / ×‘×•×“×§ ××•×¤×¦×™×•×ª"],
                aiPrompt: "× ×ª×— ××ª ×“×—×™×¤×•×ª ×”×‘×§×©×” ×•×ª×Ÿ ×˜×™×¤ ×—×›× ×¢×œ ×ª××—×•×¨ ××• ×ª×›× ×•×Ÿ."
            },
            { 
                key: "specificDates", 
                question: "×”×‘× ×ª×™. ×× ×™×© ×ª××¨×™×š ×¡×¤×¦×™×¤×™, ×›×ª×‘×• ××•×ª×• ×›××Ÿ (×œ××©×œ: 15-17 ×‘××¨×¥).\n×× ×œ×, ×¤×©×•×˜ ×”×§×œ×™×“×• '×’××™×©'.", 
                options: [],
                aiPrompt: "×ª×’×™×‘ ×œ×ª××¨×™×›×™× ×©×”××©×ª××© × ×ª×Ÿ ×•×ª×Ÿ ×˜×™×¤ ×¢×œ ××™×š ×–×” ××©×¤×™×¢ ×¢×œ ×”××¤×©×¨×•×™×•×ª."
            },
            { 
                key: "location", 
                question: "××™×–×” ××–×•×¨ ×‘××¨×¥ ××¢× ×™×™×Ÿ ××ª×›×?",
                options: ["×”×¦×¤×•×Ÿ (×’×œ×™×œ, ×’×•×œ×Ÿ)", "×”××¨×›×– (×ª×œ ××‘×™×‘, ×”×›×¨××œ)", "×”×“×¨×•× (××™×œ×ª, ××“×‘×¨)", "×™×¨×•×©×œ×™× ×•×”×¡×‘×™×‘×”", "××™×Ÿ ×”×¢×“×¤×” - ×ª×¤×ª×™×¢×• ××•×ª×™!"],
                aiPrompt: "×¢×œ ×‘×¡×™×¡ ×‘×—×™×¨×ª ×”××™×§×•×, ×ª×Ÿ ×”××œ×¦×” ×—×›××” ×¢×œ ×¤×¢×™×œ×•×™×•×ª ××• ×××¤×™×™× ×™× ×©×œ ×”××–×•×¨."
            },
            { 
                key: "amenities", 
                question: "××™×–×” ××ª×§× ×™× ×”×›×™ ×—×©×•×‘×™× ×œ×›× ×‘××§×•×?", 
                options: ["×‘×¨×™×›×” ×¤×¨×˜×™×ª", "×’'×§×•×–×™ ×¡×¤×", "××˜×‘×— ×××•×‘×–×¨", "× ×•×£ ×¤× ×•×¨××™", "×¤×¨×˜×™×•×ª ××œ××”", "×”×›×œ ××”×›×œ!", "×‘×§×©×” ××™×•×—×“×ª"],
                aiPrompt: "× ×ª×— ××ª ×“×¨×™×©×•×ª ×”××©×ª××© ×•×ª×Ÿ ×ª×•×‘× ×” ×¢×œ ××™×š ×–×” ××©×¤×™×¢ ×¢×œ ×¡×•×’ ×”× ×›×¡ ×”××ª××™×."
            },
            { 
                key: "otherAmenities", 
                question: "××” ×¢×•×“ ×—×©×•×‘ ×œ×›×? (×›×©×¨×•×ª, × ×’×™×©×•×ª, ×—× ×™×” ×•×›×•')", 
                options: [],
                aiPrompt: "×ª×’×™×‘ ×œ×“×¨×™×©×•×ª ×”××™×•×—×“×•×ª ×•×ª×Ÿ ×˜×™×¤ ××™×š ×œ××¦×•× ×‘×“×™×•×§ ××” ×©××—×¤×©×™×."
            },
            { 
                key: "budget", 
                question: "××” ×”×ª×§×¦×™×‘ ×©×œ×›×? ×–×” ×™×¢×–×•×¨ ×œ××¦×•× ××ª ×”×”×¦×¢×” ×”×›×™ ××©×ª×œ××ª.", 
                options: ["×¢×“ â‚ª2,500", "â‚ª2,500-5,000", "â‚ª5,000-10,000", "â‚ª10,000-20,000", "××¢×œ â‚ª20,000", "×’××™×©"],
                aiPrompt: "×¢×œ ×‘×¡×™×¡ ×”×ª×§×¦×™×‘, ×ª×Ÿ ×˜×™×¤ ×—×›× ×¢×œ ××™×š ×œ×§×‘×œ ××ª ×”××§×¡×™××•× ×ª××•×¨×ª ×”×›×¡×£."
            },
            { 
                key: "name", 
                question: "×›××¢×˜ ×¡×™×™×× ×•! ××” ×©××›× ×›×“×™ ×©×”×¦×•×•×ª ×™×•×›×œ ×œ×¤× ×•×ª ××œ×™×›× ××™×©×™×ª?", 
                options: [],
                aiPrompt: "×ª×›×™×Ÿ ×”×¢×¨×” ××™×©×™×ª ×•×—××” ×¢×œ ×”×§×¨×‘ ×œ×¡×™×•× ×”×ª×”×œ×™×š."
            },
            { 
                key: "phone", 
                question: "×ª×•×“×” {name}! ××” ××¡×¤×¨ ×”×˜×œ×¤×•×Ÿ ×”×˜×•×‘ ×‘×™×•×ª×¨ ×œ×—×–×•×¨ ××œ×™×›×?", 
                options: [],
                aiPrompt: "×ª×›×™×Ÿ ×”×•×“×¢×ª ×¡×™×•× ×—××” ×•××§×¦×•×¢×™×ª ×¢× ×¦×™×¤×™×•×ª ×‘×¨×•×¨×•×ª ×œ×–×× ×™ ××¢×§×‘."
            }
        ];

        // Simulated AI response function (replace with real API call)
        async function getAIResponse(userMessage, context) {
            await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
            
            const responses = [
                "×‘×—×™×¨×” ××¢×•×œ×”! ×–×” ×‘×“×™×•×§ ×”×›×™×•×•×Ÿ ×”× ×›×•×Ÿ ×œ××¦×•× ××©×”×• ××•×©×œ×.",
                "× ×”×“×¨! ×™×© ×œ×™ ×›××” ×¨×¢×™×•× ×•×ª ××¦×•×™× ×™× ×‘×›×™×•×•×Ÿ ×”×–×”.",
                "×–×” × ×•×ª×Ÿ ×œ×™ ×ª××•× ×” ×‘×¨×•×¨×” ×©×œ ××” ×©××ª× ××—×¤×©×™×.",
                "××¢× ×™×™×Ÿ! ×–×” ×¤×•×ª×— ×”×¨×‘×” ××¤×©×¨×•×™×•×ª ×˜×•×‘×•×ª.",
                "×”×‘× ×ª×™ ×‘×“×™×•×§ - ×–×” ×™×¢×–×•×¨ ×œ×™ ×œ××§×“ ××ª ×”×—×™×¤×•×©."
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        async function generateAIRecommendations() {
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            return `×¢×œ ×‘×¡×™×¡ ×”×‘×§×©×” ×©×œ×›×, ×”×›× ×ª×™ ×›××” ×”××œ×¦×•×ª ××•×ª×××•×ª:

ğŸ¡ **×¦×™××¨×™ ×‘×•×˜×™×§ ×‘×’×œ×™×œ ×”×¢×œ×™×•×Ÿ**
××•×©×œ× ×¢×‘×•×¨ ${chatState.userInfo.vacationType || '×”×—×•×¤×©×” ×©×œ×›×'} ×¢× × ×•×£ ×¤× ×•×¨××™ ×•×›×œ ×”××ª×§× ×™× ×©×‘×™×§×©×ª×.

ğŸŒŠ **×•×™×œ×” ×¢×œ ×”×›×¨××œ**
××§×•× ××“×”×™× ×¢× ×¤×¨×˜×™×•×ª ××œ××”, ××ª××™× ×‘×“×™×•×§ ×œ×’×•×“×œ ×”×§×‘×•×¦×” ×©×œ×›×.

ğŸ–ï¸ **× ×•×¤×© ×™×•×§×¨×” ×‘××™×œ×ª**
×—×•×•×™×” ××œ××” ×¢× ×¡×¤× ×•×›×œ ×”×©×™×¨×•×ª×™×, ×‘×”×ª×× ×œ×ª×§×¦×™×‘ ×©×”×’×“×¨×ª×.

×”×¦×•×•×ª ×”××§×¦×•×¢×™ ×™×—×–×•×¨ ××œ×™×›× ×¢× ×¤×¨×˜×™× ××œ××™× ×•××—×™×¨×™× ××¢×•×“×›× ×™×!`;
        }

        // UI Status Functions
        function updateAIStatus(status) {
            const indicator = document.getElementById('aiIndicator');
            const statusText = document.getElementById('aiStatus');
            
            switch(status) {
                case 'online':
                    indicator.className = 'ai-indicator';
                    statusText.textContent = '××•×œ×˜×™ AI ××§×•×•×Ÿ';
                    break;
                case 'thinking':
                    indicator.className = 'ai-indicator';
                    statusText.textContent = '××•×œ×˜×™ AI ×—×•×©×‘...';
                    break;
                case 'error':
                    indicator.className = 'ai-indicator error';
                    statusText.textContent = '××•×œ×˜×™ AI - ×‘×¢×™×™×ª ×—×™×‘×•×¨';
                    break;
            }
        }

        function showTyping() {
            typingIndicator.style.display = 'flex';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        function updateProgress() {
            const progress = (chatState.currentStep / chatFlow.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = `${chatState.currentStep}/${chatFlow.length} ×©××œ×•×ª`;
        }

        // Chat Functions
        function initChat() {
            chatMessages.innerHTML = '';
            chatState = { currentStep: 0, userInfo: {} };
            aiMemory = [];
            updateProgress();
            updateAIStatus('online');
            askNextQuestion();
        }

        async function askNextQuestion() {
            if (chatState.currentStep >= chatFlow.length) {
                await finalizeAndPrepareSummary();
                return;
            }
            
            const current = chatFlow[chatState.currentStep];
            
            // Skip amenities question if no special request was selected
            if (current.key === "otherAmenities" && chatState.userInfo.amenities !== "×‘×§×©×” ××™×•×—×“×ª") {
                chatState.currentStep++;
                askNextQuestion();
                return;
            }
            
            let questionText = current.question.replace('{name}', chatState.userInfo.name || '××•×¨×—');
            toggleInput(current.options && current.options.length === 0);
            
            await addBotMessage(questionText, current.options);
        }
        
        async function handleOptionClick(option) {
            await displayMessage('user', option);
            const current = chatFlow[chatState.currentStep];
            chatState.userInfo[current.key] = option;
            
            await processUserResponse(option);
        }

        async function handleTextInput() {
            const input = chatInput.value.trim();
            if (!input) return;
            
            chatInput.value = '';
            await displayMessage('user', input);
            
            const current = chatFlow[chatState.currentStep];
            chatState.userInfo[current.key] = input;
            
            await processUserResponse(input);
        }

        async function processUserResponse(response) {
            showTyping();
            updateAIStatus('thinking');
            
            try {
                const aiResponse = await getAIResponse(response, chatState.userInfo);
                hideTyping();
                
                if (aiResponse) {
                    await addAISuggestion(aiResponse);
                }
                
                chatState.currentStep++;
                updateProgress();
                updateAIStatus('online');
                
                setTimeout(() => {
                    askNextQuestion();
                }, 1000);
                
            } catch (error) {
                hideTyping();
                updateAIStatus('error');
                console.error('Error processing response:', error);
                
                chatState.currentStep++;
                updateProgress();
                askNextQuestion();
            }
        }

        async function finalizeAndPrepareSummary() {
            showTyping();
            updateAIStatus('thinking');
            
            try {
                const recommendations = await generateAIRecommendations();
                hideTyping();
                updateAIStatus('online');
                
                await displaySummary(recommendations);
                
            } catch (error) {
                hideTyping();
                updateAIStatus('error');
                console.error('Error generating recommendations:', error);
                
                await displayMessage('bot', '×ª×•×“×” ×¢×œ ×”××™×“×¢! ×”×¦×•×•×ª ×™×—×–×•×¨ ××œ×™×›× ×‘×”×§×“× ×¢× ×”××œ×¦×•×ª ××•×ª×××•×ª ××™×©×™×ª.');
            }
        }

        async function displayMessage(sender, text, options = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.innerHTML = sender === 'bot' ? 'ğŸ¤–' : 'ğŸ‘¤';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'message-text';
            textDiv.textContent = text;
            
            content.appendChild(textDiv);
            
            if (options && options.length > 0) {
                const quickReplies = document.createElement('div');
                quickReplies.className = 'quick-replies';
                
                options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'quick-reply';
                    button.textContent = option;
                    button.onclick = () => handleOptionClick(option);
                    quickReplies.appendChild(button);
                });
                
                content.appendChild(quickReplies);
            }
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            chatMessages.appendChild(messageDiv);
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return new Promise(resolve => setTimeout(resolve, 300));
        }

        async function addBotMessage(text, options = []) {
            return displayMessage('bot', text, options);
        }

        async function addAISuggestion(text) {
            const suggestionDiv = document.createElement('div');
            suggestionDiv.className = 'ai-suggestion';
            suggestionDiv.textContent = text;
            
            chatMessages.appendChild(suggestionDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            return new Promise(resolve => setTimeout(resolve, 300));
        }

        async function displaySummary(recommendations) {
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'summary-card';
            
            const title = document.createElement('div');
            title.className = 'summary-title';
            title.innerHTML = '<i class="fas fa-star"></i> ×¡×™×›×•× ×•×”××œ×¦×•×ª ××•×ª×××•×ª ××™×©×™×ª';
            
            const content = document.createElement('div');
            content.className = 'summary-content';
            content.textContent = recommendations;
            
            const whatsappLink = document.createElement('a');
            whatsappLink.className = 'whatsapp-button';
            whatsappLink.href = generateWhatsAppLink();
            whatsappLink.target = '_blank';
            whatsappLink.innerHTML = '<i class="fab fa-whatsapp"></i> ×©×œ×— ×œ×•×•×˜×¡××¤ ×œ×§×‘×œ×ª ×”×¦×¢×•×ª';
            
            summaryDiv.appendChild(title);
            summaryDiv.appendChild(content);
            summaryDiv.appendChild(whatsappLink);
            
            chatMessages.appendChild(summaryDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            toggleInput(true, true);
        }

        function generateWhatsAppLink() {
            const phone = '972XXXXXXXXX'; // Replace with actual phone number
            const message = `×©×œ×•×! ×¡×™×™××ª×™ ××™×œ×•×™ ×”×˜×•×¤×¡ ×‘××¢×¨×›×ª ××•×œ×˜×™ AI:

ğŸ“‹ ×¤×¨×˜×™ ×”×‘×§×©×”:
â€¢ ×¡×•×’: ${chatState.userInfo.vacationType || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×’×•×“×œ ×§×‘×•×¦×”: ${chatState.userInfo.groupSize || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×–××Ÿ: ${chatState.userInfo.timeframe || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×ª××¨×™×›×™×: ${chatState.userInfo.specificDates || '×’××™×©'}
â€¢ ××™×§×•×: ${chatState.userInfo.location || '×œ× ×¦×•×™×Ÿ'}
â€¢ ××ª×§× ×™×: ${chatState.userInfo.amenities || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×“×¨×™×©×•×ª × ×•×¡×¤×•×ª: ${chatState.userInfo.otherAmenities || '××™×Ÿ'}
â€¢ ×ª×§×¦×™×‘: ${chatState.userInfo.budget || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×©×: ${chatState.userInfo.name || '×œ× ×¦×•×™×Ÿ'}
â€¢ ×˜×œ×¤×•×Ÿ: ${chatState.userInfo.phone || '×œ× ×¦×•×™×Ÿ'}

××©××— ×œ×§×‘×œ ×”×¦×¢×•×ª ××•×ª×××•×ª!`;
            
            return `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
        }

        function toggleInput(enable, hideCompletely = false) {
            const inputArea = document.querySelector('.chat-input-area');
            if (hideCompletely) {
                inputArea.style.display = 'none';
            } else {
                inputArea.style.display = 'block';
                chatInput.disabled = !enable;
                sendButton.disabled = !enable;
                if (enable) {
                    chatInput.focus();
                }
            }
        }

        function resetConversation() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª×—×™×œ ××—×“×©?')) {
                initChat();
            }
        }

        // Event Listeners
        sendButton.addEventListener('click', handleTextInput);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleTextInput();
            }
        });

        // Initialize chat when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initChat();
            }, 500);
        });
    </script>
</body>
</html>
